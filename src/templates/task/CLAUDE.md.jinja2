# Multi-Project Task

You're in a **task directory** coordinating work across multiple repositories.

## Projects

| Role | Repository |
|------|------------|
| **External Artifacts** | `{{ external_artifact_repo }}` |
{% for project in projects %}
| Participating | `{{ project }}` |
{% endfor %}

Workflow artifacts (chunks, narratives, subsystems, investigations) live in the external repo. Implementation happens in participating projects.

## Project References

Each project has its own constraints and conventions. **When working within a project, that project's internal rules take precedence over any conflicting rules from other projects.**

Read these files to understand each project's requirements:

{% for project in projects %}
{%- set repo_name = project.split('/')[-1] %}
### {{ repo_name }}

- `./{{ repo_name }}/CLAUDE.md` - Project-specific agent instructions
- `./{{ repo_name }}/docs/trunk/GOAL.md` - Project goals and constraints
- `./{{ repo_name }}/docs/trunk/TESTING_PHILOSOPHY.md` - Testing approach

{% endfor %}
## Commands

All commands work from task root. You can also `cd` into a project for project-specific work.

**Artifact commands:** `/chunk-create`, `/chunk-plan`, `/chunk-implement`, `/chunk-complete`

**Other artifacts:** `/narrative-create`, `/subsystem-discover`, `/investigation-create`

Run `ve chunk list` to see task-level chunks. Use `/help` for detailed command guidance.

## Artifact Creation Context (Important!)

**Always run artifact creation commands from the task directory, not from individual project directories.**

When you run artifact creation commands (`ve chunk create`, `ve narrative create`, `ve investigation create`, `ve subsystem discover`), the location matters:

| Run from... | Creates... |
|-------------|------------|
| Task directory (here) | **Cross-repo artifact** in the external repo with `external.yaml` pointers in each project |
| Inside a project directory | **Local artifact** only in that project (no cross-repo visibility) |

**Why this matters:** When working on cross-repo tasks, artifacts should be visible to all participating projects. Running commands from inside a project creates project-local artifacts that other projects cannot see.

**Avoid this mistake:** Do NOT `cd` into a project directory and then run `ve chunk create` for task-level work. Always navigate back to the task root first:

```bash
# Correct - creates cross-repo artifact
ve chunk create my_feature

# Incorrect - creates local artifact only in that project
cd project_name
ve chunk create my_feature  # Warning: this creates a local chunk!
```

If you accidentally run from a project directory, the CLI will emit a warning to remind you.

## Backreferences

When implementing code that relates to a documented subsystem, add backreference
comments to link the code to its governing documentation:
```python
# Subsystem: docs/subsystems/<subsystem_name> - Brief description
```

Subsystems are the only valid code backreference type. Only subsystems represent
enduring architectural patterns that warrant code backreferences.
